{% liquid
  assign slide_count = section.blocks.size
  assign autoplay_enabled = section.settings.autoplay_enabled
  assign autoplay_duration = section.settings.autoplay_duration
  assign show_indicators = section.settings.show_indicators
  assign show_arrows = section.settings.show_arrows
  
  # Set default values if no slides exist
  if slide_count == 0
    assign slide_count = 1
  endif
%}

<div 
  class="banner-cta color-{{ section.settings.color_scheme }}" 
  style="
    --banner-height: {{ section.settings.section_height }}vh;
    --banner-bg-color: {{ section.settings.background_color }};
    --banner-text-color: {{ section.settings.text_color }};
    --banner-button-bg: {{ section.settings.button_background_color }};
    --banner-button-text: {{ section.settings.button_text_color }};
    --banner-indicator-active: {{ section.settings.indicator_active_color }};
    --banner-indicator-inactive: {{ section.settings.indicator_inactive_color }};
    --banner-padding-top: {{ section.settings.padding_top }}px;
    --banner-padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  <div class="banner-cta__container">
    <!-- Slides Container -->
    <div 
      class="banner-cta__slides"
      data-banner-slideshow
      data-autoplay="{{ autoplay_enabled }}"
      data-duration="{{ autoplay_duration }}"
      data-slide-count="{{ slide_count }}"
    >
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          <div 
            class="banner-cta__slide{% if forloop.first %} banner-cta__slide--active{% endif %}"
            data-slide="{{ forloop.index0 }}"
            style="
              {% if block.settings.background_image %}
                background-image: url('{{ block.settings.background_image | image_url: width: 2000 }}');
              {% else %}
                background-color: {{ block.settings.slide_background_color | default: section.settings.background_color }};
              {% endif %}
            "
            {{ block.shopify_attributes }}
          >
            {% if block.settings.background_image %}
              <div class="banner-cta__slide-overlay" style="background-color: {{ block.settings.overlay_color | default: 'rgba(0,0,0,0.3)' }};"></div>
            {% endif %}
            
            <div class="banner-cta__slide-content">
              <div class="banner-cta__content-wrapper">
                {% if block.settings.heading != blank %}
                  <h2 class="banner-cta__heading">
                    {{ block.settings.heading }}
                  </h2>
                {% endif %}
                
                {% if block.settings.subheading != blank %}
                  <p class="banner-cta__subheading">
                    {{ block.settings.subheading }}
                  </p>
                {% endif %}
                
                {% if block.settings.button_text != blank %}
                  <div class="banner-cta__button-wrapper">
                    <a 
                      href="{{ block.settings.button_link | default: '#' }}" 
                      class="banner-cta__button"
                      {% if block.settings.button_link == blank %}onclick="return false;"{% endif %}
                      {% if block.settings.open_in_new_tab %}target="_blank" rel="noopener"{% endif %}
                    >
                      {{ block.settings.button_text }}
                    </a>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <!-- Default slide when no blocks exist -->
        <div class="banner-cta__slide banner-cta__slide--active" data-slide="0">
          <div class="banner-cta__slide-content">
            <div class="banner-cta__content-wrapper">
              <h2 class="banner-cta__heading">Dominamos la operación de tu cocina.</h2>
              <p class="banner-cta__subheading">Equipamiento inteligente para quienes no cocinan por intuición, sino por estrategia.</p>
              <div class="banner-cta__button-wrapper">
                <a href="#" class="banner-cta__button" onclick="return false;">CONTACTANOS</a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
    
    <!-- Navigation Arrows -->
    {% if show_arrows and slide_count > 1 %}
      <button 
        class="banner-cta__arrow banner-cta__arrow--prev" 
        data-slide-prev
        aria-label="Previous slide"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <button 
        class="banner-cta__arrow banner-cta__arrow--next" 
        data-slide-next
        aria-label="Next slide"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    {% endif %}
    
    <!-- Slide Indicators -->
    {% if show_indicators and slide_count > 1 %}
      <div class="banner-cta__indicators" data-indicators>
        {% for i in (1..slide_count) %}
          <button 
            class="banner-cta__indicator{% if forloop.first %} banner-cta__indicator--active{% endif %}"
            data-slide-to="{{ forloop.index0 }}"
            aria-label="Go to slide {{ forloop.index }}"
          ></button>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

{% stylesheet %}
  .banner-cta {
    position: relative;
    width: 100%;
    height: var(--banner-height, 60vh);
    min-height: 400px;
    overflow: hidden;
    background-color: var(--banner-bg-color, #b8b8b8);
    padding-top: var(--banner-padding-top, 0);
    padding-bottom: var(--banner-padding-bottom, 0);
  }

  .banner-cta__container {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .banner-cta__slides {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .banner-cta__slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    display: flex;
    align-items: center;
    padding: 0 2rem;
  }

  .banner-cta__slide--active {
    opacity: 1;
    visibility: visible;
  }

  .banner-cta__slide-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .banner-cta__slide-content {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }

  .banner-cta__content-wrapper {
    max-width: 600px;
    color: var(--banner-text-color, #000);
    text-align: left;
  }

  .banner-cta__heading {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 700;
    line-height: 1.1;
    margin: 0 0 1.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    letter-spacing: -0.02em;
  }

  .banner-cta__subheading {
    font-size: clamp(1.1rem, 2.5vw, 1.3rem);
    line-height: 1.5;
    margin: 0 0 2rem 0;
    opacity: 0.9;
    font-weight: 400;
    max-width: 500px;
  }

  .banner-cta__button-wrapper {
    margin-top: 2rem;
  }

  .banner-cta__button {
    display: inline-block;
    background-color: var(--banner-button-bg, #333);
    color: var(--banner-button-text, #fff);
    padding: 1rem 2.5rem;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: none;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .banner-cta__button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.6s;
  }

  .banner-cta__button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  }

  .banner-cta__button:hover::before {
    left: 100%;
  }

  .banner-cta__button:active {
    transform: translateY(0);
  }

  /* Navigation Arrows */
  .banner-cta__arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 10;
    color: #333;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .banner-cta__arrow:hover {
    background: rgba(255, 255, 255, 1);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .banner-cta__arrow:focus {
    outline: 2px solid var(--banner-button-bg, #333);
    outline-offset: 2px;
  }

  .banner-cta__arrow--prev {
    left: 2rem;
  }

  .banner-cta__arrow--next {
    right: 2rem;
  }

  /* Slide Indicators */
  .banner-cta__indicators {
    position: absolute;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.75rem;
    z-index: 10;
  }

  .banner-cta__indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background-color: var(--banner-indicator-inactive, rgba(255, 255, 255, 0.5));
    position: relative;
  }

  .banner-cta__indicator--active {
    background-color: var(--banner-indicator-active, #ff0000);
  }

  .banner-cta__indicator:hover {
    transform: scale(1.2);
  }

  .banner-cta__indicator:focus {
    outline: 2px solid var(--banner-text-color, #000);
    outline-offset: 2px;
  }

  /* Responsive Design */
  @media screen and (max-width: 768px) {
    .banner-cta {
      height: auto;
      min-height: 500px;
    }

    .banner-cta__slide {
      padding: 0 1rem;
    }

    .banner-cta__content-wrapper {
      max-width: 100%;
      text-align: center;
    }

    .banner-cta__heading {
      font-size: clamp(1.8rem, 8vw, 2.5rem);
      margin-bottom: 1rem;
    }

    .banner-cta__subheading {
      font-size: clamp(1rem, 4vw, 1.2rem);
      margin-bottom: 1.5rem;
    }

    .banner-cta__button {
      padding: 0.875rem 2rem;
      font-size: 0.9rem;
    }

    .banner-cta__arrow {
      width: 40px;
      height: 40px;
    }

    .banner-cta__arrow--prev {
      left: 1rem;
    }

    .banner-cta__arrow--next {
      right: 1rem;
    }

    .banner-cta__indicators {
      bottom: 1.5rem;
    }
  }

  @media screen and (max-width: 480px) {
    .banner-cta__slide {
      padding: 0 0.75rem;
    }

    .banner-cta__indicators {
      bottom: 1rem;
      gap: 0.5rem;
    }

    .banner-cta__indicator {
      width: 10px;
      height: 10px;
    }
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    .banner-cta__slide,
    .banner-cta__button,
    .banner-cta__arrow,
    .banner-cta__indicator {
      transition: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .banner-cta__button {
      border: 2px solid var(--banner-button-text, #fff);
    }
    
    .banner-cta__arrow {
      border: 2px solid #333;
    }
    
    .banner-cta__indicator {
      border: 2px solid var(--banner-text-color, #000);
    }
  }
{% endstylesheet %}

<script>
  class BannerCTA {
    constructor(element) {
      this.element = element;
      this.slides = element.querySelectorAll('.banner-cta__slide');
      this.indicators = element.querySelectorAll('.banner-cta__indicator');
      this.prevButton = element.querySelector('[data-slide-prev]');
      this.nextButton = element.querySelector('[data-slide-next]');
      this.currentSlide = 0;
      this.isAutoplay = element.querySelector('[data-banner-slideshow]').dataset.autoplay === 'true';
      this.autoplayDuration = parseInt(element.querySelector('[data-banner-slideshow]').dataset.duration) || 5000;
      this.autoplayTimer = null;
      this.isPaused = false;
      this.isTransitioning = false;

      this.init();
    }

    init() {
      // Set initial ARIA attributes
      this.updateARIA();

      // Add event listeners
      if (this.prevButton) {
        this.prevButton.addEventListener('click', (e) => {
          e.preventDefault();
          this.goToPrevSlide();
        });
      }
      
      if (this.nextButton) {
        this.nextButton.addEventListener('click', (e) => {
          e.preventDefault();
          this.goToNextSlide();
        });
      }

      this.indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', (e) => {
          e.preventDefault();
          this.goToSlide(index);
        });
      });

      // Pause autoplay on hover and focus
      this.element.addEventListener('mouseenter', () => this.pauseAutoplay());
      this.element.addEventListener('mouseleave', () => this.resumeAutoplay());
      this.element.addEventListener('focusin', () => this.pauseAutoplay());
      this.element.addEventListener('focusout', () => this.resumeAutoplay());

      // Pause autoplay when page is not visible
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          this.pauseAutoplay();
        } else {
          this.resumeAutoplay();
        }
      });

      // Touch/swipe support
      this.addTouchSupport();

      // Start autoplay if enabled
      if (this.isAutoplay && this.slides.length > 1) {
        this.startAutoplay();
      }

      // Keyboard support
      this.element.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          this.goToPrevSlide();
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          this.goToNextSlide();
        }
      });

      // Make carousel focusable for keyboard navigation
      this.element.setAttribute('tabindex', '0');
      this.element.setAttribute('role', 'region');
      this.element.setAttribute('aria-label', 'Banner carousel');
    }

    goToSlide(index, userInitiated = true) {
      if (this.isTransitioning || index === this.currentSlide || index < 0 || index >= this.slides.length) return;

      this.isTransitioning = true;

      // Remove active class from current slide and indicator
      this.slides[this.currentSlide].classList.remove('banner-cta__slide--active');
      if (this.indicators[this.currentSlide]) {
        this.indicators[this.currentSlide].classList.remove('banner-cta__indicator--active');
      }

      // Set new current slide
      this.currentSlide = index;

      // Add active class to new slide and indicator
      this.slides[this.currentSlide].classList.add('banner-cta__slide--active');
      if (this.indicators[this.currentSlide]) {
        this.indicators[this.currentSlide].classList.add('banner-cta__indicator--active');
      }

      // Update ARIA attributes for accessibility
      this.updateARIA();

      // Reset autoplay if user initiated
      if (userInitiated && this.isAutoplay && !this.isPaused) {
        this.resetAutoplay();
      }

      // Reset transition flag after animation completes
      setTimeout(() => {
        this.isTransitioning = false;
      }, 600);
    }

    goToNextSlide() {
      const nextIndex = (this.currentSlide + 1) % this.slides.length;
      this.goToSlide(nextIndex);
    }

    goToPrevSlide() {
      const prevIndex = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
      this.goToSlide(prevIndex);
    }

    startAutoplay() {
      if (this.slides.length <= 1) return;
      
      this.autoplayTimer = setInterval(() => {
        if (!this.isPaused && !document.hidden) {
          this.goToSlide((this.currentSlide + 1) % this.slides.length, false);
        }
      }, this.autoplayDuration);
    }

    pauseAutoplay() {
      this.isPaused = true;
    }

    resumeAutoplay() {
      this.isPaused = false;
    }

    resetAutoplay() {
      if (this.autoplayTimer) {
        clearInterval(this.autoplayTimer);
      }
      this.startAutoplay();
    }

    updateARIA() {
      this.slides.forEach((slide, i) => {
        slide.setAttribute('aria-hidden', i !== this.currentSlide);
        slide.setAttribute('role', 'tabpanel');
        slide.setAttribute('aria-label', `Slide ${i + 1} of ${this.slides.length}`);
      });

      this.indicators.forEach((indicator, i) => {
        indicator.setAttribute('aria-selected', i === this.currentSlide);
        indicator.setAttribute('role', 'tab');
      });
    }

    addTouchSupport() {
      let startX = 0;
      let endX = 0;
      let startY = 0;
      let endY = 0;

      this.element.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
      }, { passive: true });

      this.element.addEventListener('touchend', (e) => {
        endX = e.changedTouches[0].clientX;
        endY = e.changedTouches[0].clientY;
        this.handleSwipe();
      }, { passive: true });

      this.handleSwipe = () => {
        const diffX = startX - endX;
        const diffY = startY - endY;
        const threshold = 50; // minimum distance for swipe

        // Only handle horizontal swipes (ignore vertical scrolling)
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > threshold) {
          if (diffX > 0) {
            // Swipe left - go to next slide
            this.goToNextSlide();
          } else {
            // Swipe right - go to previous slide
            this.goToPrevSlide();
          }
        }
      };
    }

    destroy() {
      if (this.autoplayTimer) {
        clearInterval(this.autoplayTimer);
      }
    }
  }

  // Initialize banner CTA when DOM is loaded
  function initBannerCTA() {
    const bannerCTAs = document.querySelectorAll('.banner-cta');
    bannerCTAs.forEach(banner => {
      if (!banner.bannerCTAInstance) {
        banner.bannerCTAInstance = new BannerCTA(banner);
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBannerCTA);
  } else {
    initBannerCTA();
  }

  // Reinitialize on AJAX page loads and section reloads
  document.addEventListener('shopify:section:load', (event) => {
    if (event.target.querySelector('.banner-cta')) {
      const banner = event.target.querySelector('.banner-cta');
      if (banner.bannerCTAInstance) {
        banner.bannerCTAInstance.destroy();
      }
      banner.bannerCTAInstance = new BannerCTA(banner);
    }
  });

  // Clean up on section unload
  document.addEventListener('shopify:section:unload', (event) => {
    if (event.target.querySelector('.banner-cta')) {
      const banner = event.target.querySelector('.banner-cta');
      if (banner.bannerCTAInstance) {
        banner.bannerCTAInstance.destroy();
        banner.bannerCTAInstance = null;
      }
    }
  });
</script>

{% schema %}
{
  "name": "Banner CTA",
  "tag": "section",
  "class": "banner-cta-wrapper section-wrapper",
  "max_blocks": 10,
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "header",
          "content": "Content"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Dominamos la operación de tu cocina."
        },
        {
          "type": "textarea",
          "id": "subheading",
          "label": "Subheading",
          "default": "Equipamiento inteligente para quienes no cocinan por intuición, sino por estrategia."
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "CONTACTANOS"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Open link in new tab",
          "default": false
        },
        {
          "type": "header",
          "content": "Background"
        },
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background image"
        },
        {
          "type": "color",
          "id": "slide_background_color",
          "label": "Background color (if no image)",
          "default": "#b8b8b8"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Image overlay color",
          "default": "rgba(0,0,0,0.3)"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "header",
      "content": "General Settings"
    },
    {
      "type": "range",
      "id": "section_height",
      "label": "Section height",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 60
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Default background color",
      "default": "#b8b8b8"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Carousel Controls"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show navigation arrows",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_indicators",
      "label": "Show slide indicators",
      "default": true
    },
    {
      "type": "color",
      "id": "indicator_active_color",
      "label": "Active indicator color",
      "default": "#ff0000"
    },
    {
      "type": "color",
      "id": "indicator_inactive_color",
      "label": "Inactive indicator color",
      "default": "rgba(255,255,255,0.5)"
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "autoplay_enabled",
      "label": "Enable autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_duration",
      "label": "Autoplay duration",
      "min": 2000,
      "max": 9000,
      "step": 1000,
      "unit": "ms",
      "default": 5000
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Banner CTA",
      "category": "Promotional",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "heading": "Dominamos la operación de tu cocina.",
            "subheading": "Equipamiento inteligente para quienes no cocinan por intuición, sino por estrategia.",
            "button_text": "CONTACTANOS"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Soluciones inteligentes para tu cocina",
            "subheading": "Tecnología avanzada que optimiza cada proceso culinario.",
            "button_text": "VER PRODUCTOS"
          }
        },
        {
          "type": "slide",
          "settings": {
            "heading": "Eficiencia en cada detalle",
            "subheading": "Equipos profesionales diseñados para maximizar el rendimiento.",
            "button_text": "SABER MÁS"
          }
        }
      ]
    }
  ]
}
{% endschema %}