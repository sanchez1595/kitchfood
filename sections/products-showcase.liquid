{% liquid
  assign collection = section.settings.collection
  assign products_to_show = section.settings.products_to_show | default: 5
%}

<section 
  class="products-showcase color-{{ section.settings.color_scheme }}"
  style="
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    --card-bg-color: {{ section.settings.card_background_color }};
    --price-color: {{ section.settings.price_color }};
    --button-bg-color: {{ section.settings.button_background_color }};
    --button-text-color: {{ section.settings.button_text_color }};
  "
>
  <div class="products-showcase__container">
    <!-- Section Header -->
    <div class="products-showcase__header">
      <div class="products-showcase__title-wrapper">
        <h2 class="products-showcase__heading">
          {{ section.settings.heading | default: 'Productos en tendencia' }}
        </h2>
        {% if section.settings.view_all_text != blank and section.settings.view_all_link != blank %}
          <a 
            href="{{ section.settings.view_all_link }}" 
            class="products-showcase__view-all"
          >
            {{ section.settings.view_all_text }}
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        {% endif %}
      </div>
      
      {% if section.settings.subheading != blank %}
        <p class="products-showcase__subheading">{{ section.settings.subheading }}</p>
      {% endif %}
    </div>

    <!-- Products Container -->
    <div class="products-showcase__products">
      <div class="products-showcase__scroll-container" data-scroll-container>
        <div class="products-showcase__products-grid" data-products-grid>
          {% if collection and collection.products.size > 0 %}
            {% for product in collection.products limit: products_to_show %}
              <div class="products-showcase__product-card">
                <div class="product-card">
                  <div class="product-card__image">
                    {% if product.featured_image %}
                      <img 
                        src="{{ product.featured_image | image_url: width: 400 }}"
                        alt="{{ product.featured_image.alt | escape }}"
                        width="400"
                        height="400"
                        loading="lazy"
                      >
                    {% else %}
                      <div class="product-card__placeholder">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                          <rect width="48" height="48" fill="#E5E5E5"/>
                          <path d="M16 20L24 28L32 20" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </div>
                    {% endif %}
                    
                    {% if product.compare_at_price > product.price %}
                      <div class="product-card__badge">OFERTA</div>
                    {% endif %}
                  </div>
                  
                  <div class="product-card__content">
                    <h3 class="product-card__title">
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h3>
                    
                    <div class="product-card__price">
                      {% if product.compare_at_price > product.price %}
                        <span class="product-card__price-compare">
                          {{ product.compare_at_price | money }}
                        </span>
                      {% endif %}
                      <span class="product-card__price-current">
                        {{ product.price | money }}
                      </span>
                    </div>
                    
                    {% if section.settings.show_quick_add %}
                      <button class="product-card__quick-add" data-product-id="{{ product.id }}">
                        Agregar al carrito
                      </button>
                    {% endif %}
                  </div>
                  
                  <a href="{{ product.url }}" class="product-card__link" aria-label="View {{ product.title }}"></a>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <!-- Default products when no collection is selected -->
            {% for i in (1..products_to_show) %}
              <div class="products-showcase__product-card">
                <div class="product-card">
                  <div class="product-card__image">
                    <div class="product-card__placeholder">
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <rect width="48" height="48" fill="#E5E5E5"/>
                        <path d="M16 20L24 28L32 20" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                  
                  <div class="product-card__content">
                    <h3 class="product-card__title">
                      <a href="#" onclick="return false;">Producto {{ forloop.index }}</a>
                    </h3>
                    
                    <div class="product-card__price">
                      <span class="product-card__price-current">$120,000</span>
                    </div>
                  </div>
                  
                  <a href="#" class="product-card__link" onclick="return false;" aria-label="View Producto {{ forloop.index }}"></a>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
      
      <!-- Scroll Navigation Buttons -->
      <button 
        class="products-showcase__nav products-showcase__nav--prev" 
        data-scroll-prev
        aria-label="Ver productos anteriores"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <button 
        class="products-showcase__nav products-showcase__nav--next" 
        data-scroll-next
        aria-label="Ver más productos"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</section>

{% stylesheet %}
  .products-showcase {
    padding: var(--section-padding-top, 60px) 0 var(--section-padding-bottom, 60px);
    background-color: var(--color-background);
  }

  .products-showcase__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .products-showcase__header {
    margin-bottom: 2.5rem;
  }

  .products-showcase__title-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .products-showcase__heading {
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 700;
    margin: 0;
    color: var(--color-foreground);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  }

  .products-showcase__view-all {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--button-bg-color, #ff6b35);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s ease;
  }

  .products-showcase__view-all:hover {
    transform: translateX(4px);
  }

  .products-showcase__view-all svg {
    transition: transform 0.3s ease;
  }

  .products-showcase__view-all:hover svg {
    transform: translateX(2px);
  }

  .products-showcase__subheading {
    font-size: 1rem;
    color: var(--color-foreground);
    opacity: 0.8;
    margin: 0;
  }

  .products-showcase__products {
    position: relative;
  }

  .products-showcase__scroll-container {
    overflow: hidden;
    margin: 0 -1rem;
    padding: 0 1rem;
  }

  .products-showcase__products-grid {
    display: flex;
    gap: 1.5rem;
    transition: transform 0.3s ease;
    padding-bottom: 1rem;
  }

  .products-showcase__product-card {
    flex: 0 0 280px;
  }

  .product-card {
    position: relative;
    background-color: var(--card-bg-color, #ffffff);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .product-card__image {
    position: relative;
    width: 100%;
    height: 280px;
    overflow: hidden;
    background-color: #f8f8f8;
  }

  .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-card__image img {
    transform: scale(1.05);
  }

  .product-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f0f0;
  }

  .product-card__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background-color: #ff6b35;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .product-card__content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .product-card__title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    line-height: 1.3;
  }

  .product-card__title a {
    color: var(--color-foreground);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .product-card__title a:hover {
    color: var(--button-bg-color, #ff6b35);
  }

  .product-card__price {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: auto;
  }

  .product-card__price-compare {
    font-size: 0.9rem;
    color: #999;
    text-decoration: line-through;
  }

  .product-card__price-current {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--price-color, #ff6b35);
  }

  .product-card__quick-add {
    background-color: var(--button-bg-color, #ff6b35);
    color: var(--button-text-color, #ffffff);
    border: none;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 0.5rem;
  }

  .product-card__quick-add:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
  }

  .product-card__link {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  .product-card__quick-add {
    position: relative;
    z-index: 2;
  }

  /* Navigation Buttons */
  .products-showcase__nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.95);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    color: #333;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .products-showcase__nav:hover {
    background: white;
    transform: translateY(-50%) scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .products-showcase__nav--prev {
    left: -24px;
  }

  .products-showcase__nav--next {
    right: -24px;
  }

  .products-showcase__nav:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: translateY(-50%) scale(0.95);
  }

  /* Responsive Design */
  @media screen and (max-width: 768px) {
    .products-showcase {
      padding: 40px 0;
    }

    .products-showcase__container {
      padding: 0 0.5rem;
    }

    .products-showcase__title-wrapper {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .products-showcase__scroll-container {
      margin: 0 -0.5rem;
      padding: 0 0.5rem;
    }

    .products-showcase__products-grid {
      gap: 1rem;
    }

    .products-showcase__product-card {
      flex: 0 0 250px;
    }

    .product-card__image {
      height: 250px;
    }

    .product-card__content {
      padding: 1rem;
    }

    .products-showcase__nav {
      width: 40px;
      height: 40px;
    }

    .products-showcase__nav--prev {
      left: -20px;
    }

    .products-showcase__nav--next {
      right: -20px;
    }
  }

  @media screen and (max-width: 480px) {
    .products-showcase__product-card {
      flex: 0 0 220px;
    }

    .product-card__image {
      height: 220px;
    }

    .products-showcase__nav {
      display: none;
    }
  }
{% endstylesheet %}

<script>
  class ProductsShowcase {
    constructor(element) {
      this.element = element;
      this.scrollContainer = element.querySelector('[data-scroll-container]');
      this.productsGrid = element.querySelector('[data-products-grid]');
      this.prevButton = element.querySelector('[data-scroll-prev]');
      this.nextButton = element.querySelector('[data-scroll-next]');
      this.scrollAmount = 300;
      this.currentScroll = 0;

      this.init();
    }

    init() {
      if (!this.scrollContainer || !this.productsGrid) return;

      // Add event listeners
      if (this.prevButton) {
        this.prevButton.addEventListener('click', () => this.scrollPrev());
      }
      
      if (this.nextButton) {
        this.nextButton.addEventListener('click', () => this.scrollNext());
      }

      // Touch/swipe support
      this.addTouchSupport();

      // Update navigation state
      this.updateNavigation();

      // Listen for resize events
      window.addEventListener('resize', () => this.updateNavigation());

      // Handle scroll events
      this.scrollContainer.addEventListener('scroll', () => this.updateNavigation());
    }

    scrollPrev() {
      const maxScroll = this.getMaxScroll();
      this.currentScroll = Math.max(0, this.currentScroll - this.scrollAmount);
      this.scrollContainer.scrollTo({
        left: this.currentScroll,
        behavior: 'smooth'
      });
    }

    scrollNext() {
      const maxScroll = this.getMaxScroll();
      this.currentScroll = Math.min(maxScroll, this.currentScroll + this.scrollAmount);
      this.scrollContainer.scrollTo({
        left: this.currentScroll,
        behavior: 'smooth'
      });
    }

    getMaxScroll() {
      return this.productsGrid.scrollWidth - this.scrollContainer.clientWidth;
    }

    updateNavigation() {
      if (!this.prevButton || !this.nextButton) return;

      const maxScroll = this.getMaxScroll();
      this.currentScroll = this.scrollContainer.scrollLeft;

      // Update button states
      this.prevButton.disabled = this.currentScroll <= 0;
      this.nextButton.disabled = this.currentScroll >= maxScroll;

      // Hide buttons if no scroll is possible
      const shouldShowNav = maxScroll > 0;
      this.prevButton.style.display = shouldShowNav ? 'flex' : 'none';
      this.nextButton.style.display = shouldShowNav ? 'flex' : 'none';
    }

    addTouchSupport() {
      let startX = 0;
      let scrollStart = 0;
      let isScrolling = false;

      this.scrollContainer.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        scrollStart = this.scrollContainer.scrollLeft;
        isScrolling = true;
      }, { passive: true });

      this.scrollContainer.addEventListener('touchmove', (e) => {
        if (!isScrolling) return;
        
        const currentX = e.touches[0].clientX;
        const diffX = startX - currentX;
        
        this.scrollContainer.scrollLeft = scrollStart + diffX;
      }, { passive: true });

      this.scrollContainer.addEventListener('touchend', () => {
        isScrolling = false;
        this.updateNavigation();
      }, { passive: true });
    }
  }

  // Initialize products showcase when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    const showcases = document.querySelectorAll('.products-showcase');
    showcases.forEach(showcase => {
      new ProductsShowcase(showcase);
    });
  });

  // Reinitialize on AJAX page loads
  document.addEventListener('shopify:section:load', (event) => {
    if (event.target.querySelector('.products-showcase')) {
      const showcase = event.target.querySelector('.products-showcase');
      new ProductsShowcase(showcase);
    }
  });
</script>

{% schema %}
{
  "name": "Products Showcase",
  "tag": "section",
  "class": "products-showcase-wrapper section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Productos en tendencia"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View all text",
      "default": "Ver todo →"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View all link"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show quick add button",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#ff6b35"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background",
      "default": "#ff6b35"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Products Showcase",
      "category": "Product"
    }
  ]
}
{% endschema %}